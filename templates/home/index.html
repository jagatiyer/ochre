<!-- templates/home/index.html -->
{% extends "base.html" %}

<!-- =========================================================
  EXTRA HEAD — homepage-only styles
  ========================================================= -->
{% block extra_head %}
{{ block.super }}
{% include 'shop/includes/product_unit_styles.html' %}
<style>
  /* ===============================
     HERO CAROUSEL
     =============================== */
  .carousel {
    position: relative;
    width: 100%;
    max-width: var(--container-width);
    margin: 24px auto;
    overflow: hidden;
    border-radius: 8px;
    max-height: 88vh;
  }
  .carousel-track {
    display: flex;
    transition: transform 400ms ease;
    will-change: transform;
  }
  .carousel-slide {
    min-width: 100%;
    position: relative;
  }
  .carousel-slide img {
    width: 100%;
    height: clamp(390px, 65vh, 900px);
    object-fit: cover;
    display: block;
  }
  .carousel-caption {
    position: absolute;
    left: 28px;
    bottom: 22px;
    color: #fff;
  }
  .carousel-caption h3 {
    font-family: 'Playfair Display', serif;
    font-size: 22px;
    margin-bottom: 8px;
  }

  .carousel-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.45);
    color: #fff;
    border: none;
    padding: 10px 14px;
    font-size: 26px;
    cursor: pointer;
    z-index: 10;
  }
  .carousel-arrow.left { left: 8px; }
  .carousel-arrow.right { right: 8px; }

  .carousel-dots {
    position: absolute;
    left: 50%;
    bottom: 12px;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
    z-index: 10;
  }
  .carousel-dots .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255,255,255,0.35);
    border: none;
    cursor: pointer;
  }
  .carousel-dots .dot.active {
    background: var(--accent-red);
  }

  /* Reduce gap below CTA buttons (client request) */
  .home-cta-buttons {
    margin-bottom: 24px;
  }

  @media (max-width:768px) {
    .carousel-slide img {
      height: clamp(235px, 50vh, 470px);
    }
  }
</style>
{% endblock %}

<!-- =========================================================
  MAIN CONTENT
  ========================================================= -->
{% block content %}

<div class="main">
  <div class="content home-content">

     <!-- ===============================
       HERO CAROUSEL (images / videos)
       =============================== -->
    {% if carousel_slides %}
    <section class="home-hero">
      <div class="carousel" id="home-carousel" data-autoplay-seconds="{{ carousel_slides.0.auto_slide_seconds|default:5 }}">
        <div class="carousel-track">
          {% for slide in carousel_slides %}
          <div class="carousel-slide" data-index="{{ forloop.counter0 }}">
            <img src="{{ slide.image.url }}" alt="{{ slide.title|default:'Slide' }}">
            {% if slide.title or slide.cta_text %}
            <div class="carousel-caption">
              {% if slide.title %}<h3>{{ slide.title }}</h3>{% endif %}
              {% if slide.cta_text %}
                <a class="cn carousel-cta" href="{{ slide.cta_url|default:'#' }}">{{ slide.cta_text }}</a>
              {% endif %}
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>

        <button class="carousel-arrow left">‹</button>
        <button class="carousel-arrow right">›</button>

        <div class="carousel-dots">
          {% for slide in carousel_slides %}
            <button class="dot" data-index="{{ forloop.counter0 }}"></button>
          {% endfor %}
        </div>
      </div>
    </section>
    {% endif %}

     <!-- ===============================
       CTA BUTTONS
       =============================== -->
    <div class="buttons home-cta-buttons">
      <button class="cn shop">
        <a href="{% url 'shop:shop_index' %}">SHOP</a>
      </button>
      <button class="cn stories">
        <a href="{% url 'story:story_page' %}">OUR STORY</a>
      </button>
    </div>

  </div>

    <!-- ===============================
      HANDPICKED SELECTION
      =============================== -->
  <section class="collections-page">
    <div class="collections-header">
      <div class="craft-spirits">
        <span class="dash">—</span> HANDPICKED SELECTION <span class="dash">—</span>
      </div>

      <h1>The House Favourites</h1>
      <p class="subtitle"><em>Bar-quality, without compromise.</em></p>

      <p class="description">
        Our most poured cocktail premixes are crafted with precision, balanced for clarity,
        and designed to deliver a consistent, refined serve every time.
        No excess. No shortcuts. Just the cocktail, as it should be.
      </p>
    </div>

    {% include "home/includes/featured_products.html" with products=featured_products %}
  </section>

    <!-- ===============================
      VIDEO COMMERCIALS
      =============================== -->
  <section class="collections-page">
    <div class="collections-header">
      <div class="craft-spirits">
        <span class="dash">—</span> WATCH OUR VIDEOS <span class="dash">—</span>
      </div>

      <h1>Ochre Digital Video Commercials</h1>
      <p class="subtitle"><em>We document culture. The pours are incidental.</em></p>

      <p class="description">
        Ochre doesn’t make ads. We make films which are observations of how modern
        celebration actually looks, sounds, and feels.
      </p>
    </div>

    {% include "home/includes/home_videos.html" with home_videos=home_videos %}
  </section>

    <!-- ===============================
      THE OCHRE WORLD
      =============================== -->
  {% include "home/includes/home_content_sections.html" with home_content_sections=home_content_sections %}

</div>

{% endblock %}

<!-- =========================================================
  EXTRA JS — homepage-only scripts
  ========================================================= -->
{% block extra_js %}
<script>
(function(){
  const carousel = document.getElementById('home-carousel');
  if (!carousel) return;

  const track = carousel.querySelector('.carousel-track');
  const slides = carousel.querySelectorAll('.carousel-slide');
  const dots = carousel.querySelectorAll('.dot');
  const left = carousel.querySelector('.carousel-arrow.left');
  const right = carousel.querySelector('.carousel-arrow.right');
  let index = 0;
  let timer = null;
  const autoSeconds = parseInt(carousel.dataset.autoplaySeconds || 5);

  function goTo(i){
    index = (i + slides.length) % slides.length;
    track.style.transform = `translateX(-${index * 100}%)`;
    dots.forEach(d => d.classList.toggle('active', Number(d.dataset.index) === index));
  }

  function next(){ goTo(index + 1); }
  function prev(){ goTo(index - 1); }

  function start(){
    stop();
    timer = setInterval(next, autoSeconds * 1000);
  }
  function stop(){
    if (timer) clearInterval(timer);
  }

  right && right.addEventListener('click', () => { next(); start(); });
  left && left.addEventListener('click', () => { prev(); start(); });
  dots.forEach(d => d.addEventListener('click', () => { goTo(Number(d.dataset.index)); start(); }));

  goTo(0);
  start();
})();
</script>

{% include 'includes/product_unit_script.html' %}
{% endblock %}
