{% extends "base.html" %}
{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<style>
/* Minimal styles preserved for unit select */
#product-unit-select { width:100%; padding:10px; margin:10px 0; }
</style>
{% endblock %}

{% block content %}
<div class="collection-detail-page">
    <div class="collection-detail-container">
        <div class="collection-detail-image">
            <div class="ochre-product-gallery">
                <a href="{% url 'shop:shop_index' %}" class="back-to-collections top-back">‚Üê Back to Shop</a>

                {% if item.image %}
                    <img id="ochreMainImage" src="{{ item.image.url }}" alt="{{ item.title }}" loading="lazy" style="max-width:100%;height:auto;border-radius:8px;" />
                {% elif item.gallery_images.all %}
                    {% with g=item.gallery_images.all.0 %}
                        {% if g %}
                            <img id="ochreMainImage" src="{{ g.image.url }}" alt="{{ item.title }}" loading="lazy" style="max-width:100%;height:auto;border-radius:8px;" />
                        {% endif %}
                    {% endwith %}
                {% else %}
                    <img id="ochreMainImage" src="{% static 'img/placeholder.png' %}" alt="{{ item.title }}" loading="lazy" style="max-width:100%;height:auto;border-radius:8px;" />
                {% endif %}

                {% if item.gallery_images.all %}
                <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
                    {% for g in item.gallery_images.all %}
                        <img src="{{ g.image.url }}" alt="{{ item.title }}" style="width:70px;height:70px;object-fit:cover;cursor:pointer;border:1px solid #333;border-radius:6px;" onclick="ochreSwapImage('{{ g.image.url }}')" />
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>

        <div class="collection-detail-info">
            <div class="collection-detail-category">{{ item.category.name }}</div>
            <h1 class="collection-detail-title">{{ item.title }}</h1>

            {% if item.description %}
            <p class="collection-detail-excerpt">{{ item.description|striptags|truncatewords:30 }}</p>
            {% endif %}

            {% if item.active_units %}
                <label for="product-unit-select">Size</label>
                <select id="product-unit-select" name="product_unit_id">
                    {% for u in item.active_units %}
                        <option value="{{ u.id }}" data-price="{{ u.price }}" {% if u.is_default %}selected{% endif %}>{{ u.label }}</option>
                    {% endfor %}
                </select>
            {% else %}
                {# Experience booking UI #}
                <form method="post" action="{% url 'shop:experience_booking_create' %}" class="contact-form">
                    {% csrf_token %}
                    <input type="hidden" name="experience_id" value="{{ item.id }}">
                    <div class="form-row">
                        <input id="booking-name" name="customer_name" type="text" placeholder="Full name" required>
                        <input id="booking-email" name="customer_email" type="email" placeholder="Email" required>
                    </div>
                    <div class="form-row">
                        <input id="booking-phone" name="customer_phone" type="tel" placeholder="Phone (optional)">
                        <input id="booking-date" name="preferred_date" type="text" placeholder="Preferred date (optional)">
                    </div>
                    <textarea id="booking-notes" name="notes" rows="3" placeholder="Notes (optional)"></textarea>
                    <button type="submit" class="cn shop">Request Booking</button>
                </form>
            {% endif %}

            {% if item.description %}
            <div class="collection-detail-content">{{ item.description|safe }}</div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function ochreSwapImage(url){ var img = document.getElementById('ochreMainImage'); if(img){ img.src = url; } }
</script>
{% endblock %}
                        loading="lazy"
