{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="collection-detail-page">
    <div class="collection-detail-container">

        <!-- LEFT: IMAGE / GALLERY -->
        <div class="collection-detail-image">

            <div class="ochre-product-gallery">

                {% if item.image %}
                <img
                    id="ochreMainImage"
                    src="{{ item.image.url }}"
                    alt="{{ item.title }}"
                    loading="lazy"
                    style="max-width:100%;height:auto;"
                >
                {% else %}
                <img
                    id="ochreMainImage"
                    src="{% static 'img/placeholder.png' %}"
                    alt="{{ item.title }}"
                    loading="lazy"
                    style="max-width:100%;height:auto;"
                >
                {% endif %}

                {% if item.gallery_images.all %}
                <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;">
                    {% for g in item.gallery_images.all %}
                        <img
                            src="{{ g.image.url }}"
                            alt="{{ item.title }}"
                            style="width:70px;height:70px;object-fit:cover;cursor:pointer;border:1px solid #333;"
                            onclick="ochreSwapImage('{{ g.image.url }}')"
                        >
                    {% endfor %}
                </div>
                {% endif %}

            </div>
        </div>

        <!-- RIGHT: DETAILS -->
        <div class="collection-detail-info">

            <div class="collection-detail-category">
                {{ item.category.name }}
            </div>

            <h1 class="collection-detail-title">{{ item.title }}</h1>

            {% if item.description %}
            <p class="collection-detail-excerpt">
                {{ item.description|striptags|truncatewords:30 }}
            </p>
            {% endif %}

            <!-- PRICE -->
            <div style="font-size:22px;color:#00d2c7;margin-bottom:12px;">
                <span id="product-price">
                    {% if item.has_units %}
                        {% with d=item.default_unit %}
                            {% if d %}₹ {{ d.price }}{% else %}{{ item.price_display }}{% endif %}
                        {% endwith %}
                    {% else %}
                        {{ item.price_display }}
                    {% endif %}
                </span>
            </div>

            <!-- ADD TO CART / BOOKING -->
            {% if not item.is_experience %}
            <form method="post" action="{% url 'shop:add_to_cart' %}">
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ item.id }}">
                <input type="hidden" name="qty" value="1">

                {% if item.has_units %}
                <select id="product-unit-select" name="product_unit_id">
                    {% for u in item.active_units %}
                        <option value="{{ u.id }}" data-price="{{ u.price }}"
                                {% if u.is_default %}selected{% endif %}>
                            {{ u.label }}
                        </option>
                    {% endfor %}
                </select>
                {% endif %}

                <button type="submit" class="cn shop">
                    Add to Cart
                </button>
            </form>
            {% endif %}

            {% if item.description %}
            <div class="collection-detail-content">
                {{ item.description|safe }}
            </div>
            {% endif %}

            <a href="{% url 'shop:shop_index' %}" class="back-to-collections">
                ← Back to Shop
            </a>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function ochreSwapImage(url){
    var img = document.getElementById('ochreMainImage');
    if(img){ img.src = url; }
}
</script>
{% endblock %}
